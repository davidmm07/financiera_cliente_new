<div class="container-fluid">
  <div class="row">
    <div class="col-md-12">
      <div class="row">
        <!-- fuente -->

        <div class="col-md-12">
          <!-- info fuente -->
              <nb-stepper #steep orientation="vertical">
                  <nb-step label="{{'FUENTE_FINANCIAMIENTO.asignar_fuente' | translate }}">

                    <div>
                            <ngx-dinamicform [normalform]="formInfoFuente" [modeloData]="info_fuente" (result)="validarForm($event)"
                                    [clean]="clean">
                                  </ngx-dinamicform>
                    </div>
                  </nb-step>
                  <nb-step label="{{'RUBRO.asignar_rubro' | translate }}">

                    <div class="col-md-12 col-lg-12 col-xxxl-12">
                        <div class="row">
                          <ngx-arbol (rubroSeleccionado)="receiveMessage($event)" [optionSelect]="optionView"></ngx-arbol>            
                        </div>
                        <div class="row" >
                          <nb-card class="col-md-12" *ngIf="rubrosAsignados.length >0"  ><nb-card-body>
                            
                          
                      <!-- dependencias -->
                      <div class="col-md-12" *ngFor="let rubro of rubrosAsignados">
                          <div>
                            <h5>{{'GLOBAL.rubro' | translate}}: {{rubro.Codigo}} {{rubro.Nombre}}</h5>
                          </div>
                            <div class="row form-group">
                              <label for="" class="col-md-4">{{'GLOBAL.dependencia' | translate}}</label>
                              <label for="valor" class="col-md-4 offset-1">{{'GLOBAL.valor' | translate}}</label>
                            </div>
                          <div *ngFor="let dependenciasAsignadas of rubro.Dependencias; let index = index">
                              <label for="" class="col-md-3">
                                <span class=".glyphicon .glyphicon-remove"></span>
                              </label>
                            <div class="row">
                              <select [(ngModel)]="dependenciasAsignadas.Id"
                                class="form-control col-md-4 dropdown">
                                <option *ngFor="let dependencia of dependencias; let value = index;" [ngValue]="dependencia.Id" >{{dependencia.Nombre}}
                                </option>
                              </select>
                              <input type="number" name="'dependenciasAsignadas.ValorDependencia' + index" id="" [(ngModel)]="dependenciasAsignadas.ValorDependencia" class="form-control col-md-2 offset-1">
                              <button *ngIf="!entrarEditar && index == (rubro.Dependencias.length)-1" (click)="asignarDependencia($event.target.value, rubro, dependenciasAsignadas, index)"
                              class="btn btn-sm btn-outline-primary col-md-1 offset-md-1">{{'GLOBAL.guardar' | translate}}</button>
                              <button *ngIf="validarEdicionDependencias(rubro , dependenciasAsignadas, index)" (click)="entrandoEditar(dependenciasAsignadas)"
                              class="btn btn-sm btn-outline-success col-md-1 offset-md-1">{{'GLOBAL.editar' | translate}}</button>
                              <button *ngIf="entrarEditar" (click)="editarDependencia($event.target.value, rubro, dependenciasAsignadas, index)"
                              class="btn btn-sm btn-outline-success col-md-1 offset-md-1">{{'GLOBAL.guardar' | translate}}</button>                                                               
                              <button (click)="quitarDependencia($event, rubro)"
                              class="btn btn-sm btn-outline-danger col-md-1 offset-md-1">{{'GLOBAL.eliminar' | translate}}</button>
              
                            </div>
                          </div>
                          <div class="form-group mt-2">
                            <button
                              class="btn btn-outline-danger col-md-12 mt-1" (click)="quitarRubro(rubro)">{{'FUENTE_FINANCIAMIENTO.remove-rubro' | translate}}</button>
                          </div>
                        </div>
                      </nb-card-body></nb-card>              
                        </div>
                      </div>
<nb-card>
  <nb-card-body>
    <nb-alert *ngIf="!totalPermitido" accent="danger">{{'GLOBAL.max_dependencias' | translate}} </nb-alert>
                      <div align="right" class="form-group">
                          <button class="btn btn-outline-primary btn-md " nbStepperPrevious 
                              >{{'GLOBAL.regresar' | translate}}</button>
                          <button *ngIf="totalPermitido && entrarAddProductos" class="btn btn-outline-success btn-md offset-1 " (click)="registrar()">{{'GLOBAL.guardar' | translate}}</button>
                      </div>    
  </nb-card-body>
</nb-card>


                  </nb-step>
                </nb-stepper>

        </div>
        <!-- arbol -->

      </div>
    </div>
  </div>
</div>